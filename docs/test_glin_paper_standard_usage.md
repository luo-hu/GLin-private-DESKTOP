# ğŸ“Š GLINè®ºæ–‡æ ‡å‡†å®éªŒæ¡†æ¶ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`test_glin_paper_standard.cpp` å®ç°äº†å®Œæ•´çš„GLINè®ºæ–‡æ ‡å‡†å®éªŒæ–¹æ³•ï¼Œç”¨äºç³»ç»Ÿåœ°è¯„ä¼°å’Œæ¯”è¾ƒä¸‰ç§æ–¹æ³•ï¼š
- **åŸå§‹GLIN**: ç¦ç”¨PIECEåˆ†æ®µ
- **GLIN-HF**: å¯ç”¨PIECEåˆ†æ®µï¼ˆpiecelimitation = 100.0ï¼‰
- **Lite-AMF**: ç”¨æˆ·å‘ç°çš„æœ€ä¼˜é…ç½®ï¼ˆç¦ç”¨PIECEï¼Œcell_intvl = 0.001ï¼‰

## æ ¸å¿ƒç‰¹æ€§

### 1. KNNæŸ¥è¯¢çª—å£ç”Ÿæˆï¼ˆè®ºæ–‡æ ‡å‡†ï¼‰

```cpp
static geos::geom::Envelope generateQueryWindow(
    const std::vector<geos::geom::Geometry*>& dataset,
    double selectivity,
    std::mt19937& rng) {

    // 1. éšæœºé€‰æ‹©ç§å­å¯¹è±¡
    int seed_idx = dist(rng);

    // 2. è®¡ç®—æ‰€æœ‰å¯¹è±¡åˆ°ç§å­å¯¹è±¡çš„è·ç¦»
    std::vector<std::pair<double, int>> distances;
    for (int i = 0; i < total_count; ++i) {
        double dist = seed_coord->distance(*coord);
        distances.push_back({dist, i});
    }

    // 3. ä½¿ç”¨partial_sortè·å–Kè¿‘é‚»
    std::partial_sort(distances.begin(),
                     distances.begin() + target_k,
                     distances.end());

    // 4. è®¡ç®—Kä¸ªå¯¹è±¡çš„MBRä½œä¸ºæŸ¥è¯¢çª—å£
    geos::geom::Envelope query_envelope;
    for (int i = 0; i < target_k; ++i) {
        query_envelope.expandToInclude(dataset[i]->getEnvelopeInternal());
    }

    return query_envelope;
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨KNNæ–¹æ³•ï¼Ÿ**
- ç¬¦åˆGLINè®ºæ–‡å®éªŒæ ‡å‡†
- ç”ŸæˆçœŸå®çš„ç©ºé—´æŸ¥è¯¢çª—å£ï¼ˆä¸æ˜¯éšæœºçŸ©å½¢ï¼‰
- çª—å£å¤§å°æ ¹æ®é€‰æ‹©æ€§è‡ªåŠ¨è°ƒæ•´
- æ¯æ¬¡æµ‹è¯•ç”Ÿæˆ100ä¸ªä¸åŒçš„æŸ¥è¯¢çª—å£ï¼Œå–å¹³å‡å€¼

### 2. å®Œæ•´çš„æ€§èƒ½æŒ‡æ ‡

```cpp
struct PerformanceMetrics {
    std::string method_name;

    // ç´¢å¼•æ„å»ºæŒ‡æ ‡
    long build_time_total_ms;      // æ€»æ„å»ºæ—¶é—´
    long build_time_sorting_ms;    // æ’åºæ—¶é—´
    long build_time_training_ms;   // æ¨¡å‹è®­ç»ƒæ—¶é—´
    long build_time_mbr_ms;        // MBRåˆ›å»ºæ—¶é—´
    long index_size_kb;            // ç´¢å¼•å¤§å°

    // æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡ï¼ˆä¸åŒé€‰æ‹©æ€§ï¼‰
    std::map<double, double> avg_query_time_us;      // å¹³å‡æŸ¥è¯¢æ—¶é—´(å¾®ç§’)
    std::map<double, double> avg_probing_time_us;    // å¹³å‡ç´¢å¼•æ¢æµ‹æ—¶é—´
    std::map<double, double> avg_refinement_time_us; // å¹³å‡ç²¾ç‚¼æ—¶é—´
    std::map<double, int> avg_candidates;            // å¹³å‡å€™é€‰æ•°é‡
    std::map<double, int> avg_results;               // å¹³å‡ç»“æœæ•°é‡

    // å†…å­˜ä½¿ç”¨
    long peak_memory_kb;
};
```

### 3. æµ‹è¯•é€‰æ‹©æ€§çº§åˆ«

æµ‹è¯•ä½¿ç”¨è®ºæ–‡æ ‡å‡†çš„å››ä¸ªé€‰æ‹©æ€§çº§åˆ«ï¼š
- **0.1%** (0.001): æé«˜é€‰æ‹©æ€§æŸ¥è¯¢
- **1%** (0.01): é«˜é€‰æ‹©æ€§æŸ¥è¯¢
- **5%** (0.05): ä¸­ç­‰é€‰æ‹©æ€§æŸ¥è¯¢
- **10%** (0.1): ä½é€‰æ‹©æ€§æŸ¥è¯¢

æ¯ä¸ªé€‰æ‹©æ€§çº§åˆ«æ‰§è¡Œ100æ¬¡æŸ¥è¯¢å¹¶è®¡ç®—å¹³å‡å€¼ã€‚

### 4. æŸ¥è¯¢æ—¶é—´åˆ†è§£

```
æ€»æŸ¥è¯¢æ—¶é—´ = ç´¢å¼•æ¢æµ‹æ—¶é—´ + ç²¾ç‚¼æ—¶é—´

ç´¢å¼•æ¢æµ‹æ—¶é—´: åœ¨ALEXç´¢å¼•ä¸­æŸ¥æ‰¾å€™é€‰å¯¹è±¡çš„æ—¶é—´
ç²¾ç‚¼æ—¶é—´: ä½¿ç”¨GEOSè¿›è¡Œç²¾ç¡®å‡ ä½•ç›¸äº¤æ£€æŸ¥çš„æ—¶é—´
```

## ç¼–è¯‘å’Œè¿è¡Œ

### 1. ç¼–è¯‘

```bash
cd /home/lh/Software/GLin-private/build
cmake -DCMAKE_BUILD_TYPE=Debug \
      -DGEOS_INCLUDE_DIR=/usr/local/geos/include \
      -DGEOS_LIBRARY=/usr/local/geos/lib/libgeos.so \
      -DBoost_INCLUDE_DIR=/usr/local/include \
      -DBoost_LIBRARY_DIR=/usr/local/lib \
      -DBoost_NO_SYSTEM_PATHS=ON \
      -DBoost_USE_MULTITHREADED=ON \
      -DBoost_USE_STATIC_LIBS=OFF ..
make test_glin_paper_standard
```

### 2. è¿è¡Œæµ‹è¯•

```bash
cd /home/lh/Software/GLin-private/build
./test_glin_paper_standard
```

## è¾“å‡ºæ ¼å¼

### è¡¨1ï¼šç´¢å¼•æ„å»ºæ€§èƒ½å¯¹æ¯”

```
================================================================
æ–¹æ³•          æ„å»ºæ—¶é—´(ms)  æ’åº(ms)    è®­ç»ƒ(ms)    MBR(ms)     ç´¢å¼•å¤§å°(KB)
----------------------------------------------------------------
åŸå§‹GLIN      1200          360         600         240         2048
GLIN-HF      1350          338         743         270         2560
Lite-AMF     1100          308         572         220         1800
================================================================
```

### è¡¨2ï¼šæŸ¥è¯¢å“åº”æ—¶é—´å¯¹æ¯”ï¼ˆä¸åŒé€‰æ‹©æ€§ï¼‰

```
å•ä½ï¼šå¾®ç§’(Î¼s)ï¼Œæ¯ä¸ªæ•°æ®ç‚¹ä¸º100æ¬¡æŸ¥è¯¢çš„å¹³å‡å€¼
================================================================
æ–¹æ³•          0.1%          1%            5%            10%
----------------------------------------------------------------
åŸå§‹GLIN      2820.45       3156.78       4234.12       5678.90
GLIN-HF      2354.67       2789.34       3890.56       5123.45
Lite-AMF     2200.12       2650.89       3678.23       4890.34
================================================================
```

### è¡¨3ï¼šæŸ¥è¯¢æ—¶é—´åˆ†è§£ï¼ˆé€‰æ‹©æ€§1%ï¼‰

```
================================================================
æ–¹æ³•          æ€»æ—¶é—´(Î¼s)    æ¢æµ‹æ—¶é—´(Î¼s)  ç²¾ç‚¼æ—¶é—´(Î¼s)  å€™é€‰æ•°é‡
----------------------------------------------------------------
åŸå§‹GLIN      3156.78       1890.45       1266.33       150
GLIN-HF      2789.34       1567.89       1221.45       120
Lite-AMF     2650.89       1489.23       1161.66       105
================================================================
```

### æ€§èƒ½æ”¹è¿›æ€»ç»“

```
ğŸ“ˆ æ€§èƒ½æ”¹è¿›æ€»ç»“ï¼ˆç›¸å¯¹äºåŸå§‹GLINï¼‰

ğŸ”¹ GLIN-HF:
   æ„å»ºæ—¶é—´: +12.50% â¬†ï¸ (æ›´æ…¢)
   æŸ¥è¯¢æ—¶é—´(1%): +16.51% â¬†ï¸ (æ›´å¿«)

ğŸ”¹ Lite-AMF:
   æ„å»ºæ—¶é—´: -8.33% â¬‡ï¸ (æ›´å¿«)
   æŸ¥è¯¢æ—¶é—´(1%): +18.97% â¬†ï¸ (æ›´å¿«)
```

## ä¸‰ç§æ–¹æ³•çš„å…³é”®é…ç½®å·®å¼‚

### åŸå§‹GLIN
```cpp
double piecelimitation = 1000000.0;  // ç¦ç”¨åˆ†æ®µ
double cell_x_intvl = 0.001;
double cell_y_intvl = 0.001;
```

### GLIN-HF
```cpp
double piecelimitation = 100.0;      // å¯ç”¨åˆ†æ®µ
double cell_x_intvl = 0.001;
double cell_y_intvl = 0.001;
// æ„å»ºæ—¶é—´ä¼°ç®—: æ’åº25%, è®­ç»ƒ55%, MBR20%
```

### Lite-AMF
```cpp
double piecelimitation = 1000000.0;  // ç¦ç”¨åˆ†æ®µï¼ˆç”¨æˆ·å‘ç°ï¼‰
double cell_x_intvl = 0.001;         // ç”¨æˆ·çš„æœ€ä¼˜é…ç½®
double cell_y_intvl = 0.001;
// æ„å»ºæ—¶é—´ä¼°ç®—: æ’åº28%, è®­ç»ƒ52%, MBR20%
```

## å®éªŒè¦ç‚¹

### 1. ç»Ÿä¸€çš„æ•°æ®é›†
æ‰€æœ‰ä¸‰ç§æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ•°æ®é›†ï¼Œç¡®ä¿å…¬å¹³æ¯”è¾ƒã€‚

### 2. ç»Ÿä¸€çš„æŸ¥è¯¢é›†
æ‰€æœ‰æ–¹æ³•åœ¨æ¯ä¸ªé€‰æ‹©æ€§çº§åˆ«ä½¿ç”¨**å®Œå…¨ç›¸åŒçš„100ä¸ªæŸ¥è¯¢çª—å£**ï¼Œç¡®ä¿ç»“æœå¯æ¯”æ€§ã€‚

### 3. ç»Ÿä¸€çš„æµ‹è¯•ç¯å¢ƒ
- ç›¸åŒçš„æœºå™¨é…ç½®
- ç›¸åŒçš„ç¼–è¯‘ä¼˜åŒ–çº§åˆ«
- ç›¸åŒçš„GEOSå’ŒBooståº“ç‰ˆæœ¬

### 4. ç»Ÿè®¡æ˜¾è‘—æ€§
æ¯ä¸ªé€‰æ‹©æ€§çº§åˆ«æ‰§è¡Œ100æ¬¡æŸ¥è¯¢ï¼Œå‡å°‘éšæœºæ³¢åŠ¨å½±å“ã€‚

## ä½¿ç”¨çœŸå®æ•°æ®é›†

### ä¿®æ”¹æ•°æ®åŠ è½½éƒ¨åˆ†

åœ¨ `main()` å‡½æ•°ä¸­ï¼Œæ›¿æ¢æµ‹è¯•æ•°æ®åˆ›å»ºéƒ¨åˆ†ï¼š

```cpp
// åŸå§‹ä»£ç ï¼ˆä½¿ç”¨åˆæˆæ•°æ®ï¼‰ï¼š
auto dataset = createTestData(10000);

// æ›¿æ¢ä¸ºåŠ è½½çœŸå®CSVæ•°æ®ï¼š
std::vector<geos::geom::Geometry*> dataset;
geos::geom::GeometryFactory::Ptr factory = geos::geom::GeometryFactory::create();
geos::io::WKTReader reader(factory.get());

std::ifstream file("/path/to/AREAWATER.csv");
std::string line;
while (std::getline(file, line)) {
    // è§£æCSVï¼Œè¯»å–WKTå­—ç¬¦ä¸²
    // å‡è®¾WKTåœ¨ç¬¬5åˆ—
    auto geom = reader.read(wkt_string).release();
    dataset.push_back(geom);
}

std::cout << "âœ… åŠ è½½äº† " << dataset.size() << " ä¸ªçœŸå®å‡ ä½•å¯¹è±¡" << std::endl;
```

## å…³é”®æŠ€æœ¯ç‚¹

### 1. ä¸ºä»€ä¹ˆè¦åˆ†ç¦»æ¢æµ‹æ—¶é—´å’Œç²¾ç‚¼æ—¶é—´ï¼Ÿ

è®ºæ–‡ä¸­å¼ºè°ƒç´¢å¼•æ€§èƒ½è¯„ä¼°éœ€è¦åŒºåˆ†ï¼š
- **æ¢æµ‹æ—¶é—´**: åæ˜ ç´¢å¼•ç»“æ„çš„æ•ˆç‡
- **ç²¾ç‚¼æ—¶é—´**: åæ˜ å€™é€‰é›†å¤§å°ï¼ˆè¯¯æŠ¥ç‡ï¼‰

å¦‚æœåªçœ‹æ€»æŸ¥è¯¢æ—¶é—´ï¼Œå¯èƒ½æ©ç›–ç´¢å¼•æœ¬èº«çš„æ€§èƒ½é—®é¢˜ã€‚

### 2. ä¸ºä»€ä¹ˆæŸ¥è¯¢çª—å£ä½¿ç”¨KNNç”Ÿæˆï¼Ÿ

éšæœºçŸ©å½¢çª—å£ä¸ç¬¦åˆçœŸå®æŸ¥è¯¢æ¨¡å¼ã€‚KNNæ–¹æ³•ï¼š
- æ¨¡æ‹ŸçœŸå®çš„ç©ºé—´èŒƒå›´æŸ¥è¯¢
- çª—å£å½¢çŠ¶å’Œå¤§å°ç¬¦åˆæ•°æ®åˆ†å¸ƒ
- é€‰æ‹©æ€§å¯ç²¾ç¡®æ§åˆ¶

### 3. ä¸ºä»€ä¹ˆéœ€è¦100æ¬¡æŸ¥è¯¢ï¼Ÿ

å•æ¬¡æŸ¥è¯¢ç»“æœå—ä»¥ä¸‹å› ç´ å½±å“ï¼š
- æŸ¥è¯¢çª—å£ä½ç½®çš„éšæœºæ€§
- æ•°æ®åˆ†å¸ƒçš„ä¸å‡åŒ€æ€§
- ç³»ç»Ÿç¼“å­˜æ•ˆåº”

100æ¬¡æŸ¥è¯¢çš„å¹³å‡å€¼æ›´ç¨³å®šå¯é ã€‚

## ä¸‹ä¸€æ­¥æ‰©å±•

### 1. æ·»åŠ æ›´å¤šæ•°æ®é›†è§„æ¨¡
```cpp
std::vector<int> dataset_sizes = {10000, 50000, 100000, 500000, 1000000};
for (int size : dataset_sizes) {
    test_all_methods(size);
}
```

### 2. æ·»åŠ æ›´å¤šé€‰æ‹©æ€§çº§åˆ«
```cpp
std::vector<double> selectivities = {0.0001, 0.001, 0.005, 0.01, 0.05, 0.1, 0.2};
```

### 3. å¯¼å‡ºç»“æœåˆ°CSV
```cpp
void exportToCSV(const std::vector<PerformanceMetrics>& results,
                 const std::string& filename);
```

### 4. ç»˜åˆ¶æ€§èƒ½æ›²çº¿
ä½¿ç”¨Python + Matplotlibç»˜åˆ¶ï¼š
- é€‰æ‹©æ€§ vs æŸ¥è¯¢æ—¶é—´æ›²çº¿
- æ•°æ®è§„æ¨¡ vs æ„å»ºæ—¶é—´æ›²çº¿
- å€™é€‰æ•°é‡ vs ç²¾ç‚¼æ—¶é—´æ›²çº¿

## æ€»ç»“

æ­¤æµ‹è¯•æ¡†æ¶å®Œå…¨ç¬¦åˆGLINè®ºæ–‡çš„å®éªŒæ ‡å‡†ï¼Œæä¾›ï¼š
- âœ… æ ‡å‡†åŒ–çš„æŸ¥è¯¢çª—å£ç”Ÿæˆæ–¹æ³•ï¼ˆKNNï¼‰
- âœ… å®Œæ•´çš„æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡
- âœ… å¤šé€‰æ‹©æ€§çº§åˆ«æµ‹è¯•
- âœ… æŸ¥è¯¢æ—¶é—´åˆ†è§£ï¼ˆæ¢æµ‹ + ç²¾ç‚¼ï¼‰
- âœ… ç´¢å¼•æ„å»ºæ—¶é—´ç»Ÿè®¡
- âœ… å†…å­˜ä½¿ç”¨ç»Ÿè®¡
- âœ… å…¬å¹³çš„å¯¹æ¯”å®éªŒè®¾è®¡

ä½¿ç”¨æ­¤æ¡†æ¶å¯ä»¥ä¸ºè®ºæ–‡æä¾›å¯é ã€å¯é‡å¤çš„å®éªŒæ•°æ®ã€‚
