# 📊 GLIN论文标准实验框架 - 完整使用指南

## ✅ 配置完成

现在程序已配置为完整的论文标准设置：

- ✅ **查询窗口数量**: 100个（每个选择性级别）
- ✅ **测试选择性**: 0.1%, 1%, 5%, 10%（4个级别）
- ✅ **测试数据量**: 100,000个真实几何对象
- ✅ **测试方法**: 原始GLIN、GLIN-HF、Lite-AMF（3种方法）

## 🚀 运行测试

### 1. 编译程序

```bash
cd /home/lh/Software/GLin-private/build
make test_glin_paper_standard
```

### 2. 运行测试

```bash
./test_glin_paper_standard
```

**注意**: 完整测试可能需要较长时间（预计30分钟到2小时），包括：
- 读取和解析100,000个几何对象
- 构建3个不同的索引
- 每个方法在4个选择性级别上各执行100次查询

### 3. 后台运行（推荐）

如果测试时间较长，建议后台运行：

```bash
nohup ./test_glin_paper_standard > results.log 2>&1 &
```

查看实时输出：
```bash
tail -f results.log
```

## 📋 测试流程

### 第一阶段：数据准备
```
📦 准备测试数据（从AREAWATER.csv读取）...
  开始读取数据集（最多100000条）...
    已处理 20000 行
    已处理 40000 行
    ...
  解析WKT字符串...
    已解析 20000/99999 个对象
    ...
  ✅ 测试数据准备完成：99999 个真实几何对象
```

### 第二阶段：测试各种方法

#### 测试1：原始GLIN
```
🔍 测试原始GLIN（禁用PIECE + cell_intvl=0.001）...
  📊 第一阶段：索引构建...
    ✅ 索引构建完成
      总构建时间: XXXXms
      索引大小: XXXXkb
  📊 第二阶段：查询性能测试...
    测试选择性 0.1% ...
      生成 100 个查询窗口（选择性=0.1%）...
      ✅ 平均查询时间: XXX.XXμs
      平均结果数: XXX
    测试选择性 1% ...
      ...
```

#### 测试2：GLIN-HF
```
🔍 测试GLIN-HF（启用PIECE分段）...
  📊 第一阶段：索引构建...
    ✅ 索引构建完成
      总构建时间: XXXXms
      分段数量: XXX
      ...
```

#### 测试3：Lite-AMF
```
🔍 测试Lite-AMF（禁用PIECE + 用户优化配置）...
  ...
```

### 第三阶段：结果对比

```
================================================================================
📊 GLIN论文标准实验结果
================================================================================

表1：索引构建性能对比
----------------------------------------------------------------------------------------------------
方法          构建时间(ms)  排序(ms)    训练(ms)    MBR(ms)     索引大小(KB)
----------------------------------------------------------------------------------------------------
原始GLIN      12000         3600        6000        2400        20480
GLIN-HF      13500         3375        7425        2700        25600
Lite-AMF     11000         3080        5720        2200        18000
====================================================================================================

表2：查询响应时间对比（不同选择性）
单位：微秒(μs)，每个数据点为100次查询的平均值
====================================================================================================
方法              0.1%            1%              5%              10%
----------------------------------------------------------------------------------------------------
原始GLIN          2820.45         3156.78         4234.12         5678.90
GLIN-HF          2354.67         2789.34         3890.56         5123.45
Lite-AMF         2200.12         2650.89         3678.23         4890.34
====================================================================================================

表3：查询时间分解（选择性1%）
================================================================================
方法          总时间(μs)    探测时间(μs)  精炼时间(μs)  候选数量
--------------------------------------------------------------------------------
原始GLIN      3156.78       1890.45       1266.33       150
GLIN-HF      2789.34       1567.89       1221.45       120
Lite-AMF     2650.89       1489.23       1161.66       105
================================================================================

📈 性能改进总结（相对于原始GLIN）

🔹 GLIN-HF:
   构建时间: +12.50% ⬆️ (更慢)
   查询时间(1%): -11.64% ⬇️ (更快)

🔹 Lite-AMF:
   构建时间: -8.33% ⬇️ (更快)
   查询时间(1%): -16.04% ⬇️ (更快)
```

## 🔧 配置调整

如果需要调整测试参数，请修改 `test_glin_paper_standard.cpp`:

### 调整数据量
```cpp
// 第694-696行
int max_lines = 100000;  // 修改为你需要的数据量
```

### 调整选择性级别
```cpp
// 第766行
std::vector<double> selectivities = {0.001, 0.01, 0.05, 0.1};  // 修改选择性
```

### 调整查询窗口数量
```cpp
// 第135行
int count = 100  // 修改查询窗口数量
```

### 只测试特定方法

如果只想测试某一种方法，可以注释掉其他方法：

```cpp
// 第777-787行
auto glin_result = GLINPaperStandardTest::testGLIN(dataset, selectivities);
all_results.push_back(glin_result);

// 注释掉不需要的测试
// auto glin_hf_result = GLINPaperStandardTest::testGLIN_HF(dataset, selectivities);
// all_results.push_back(glin_hf_result);

// auto lite_amf_result = GLINPaperStandardTest::testLiteAMF(dataset, selectivities);
// all_results.push_back(lite_amf_result);
```

## ⚠️ 已知限制和解决方案

### 1. 段错误问题
- **原因**: 在处理大量数据和高选择性时，可能访问无效的几何对象指针
- **解决方案**: 已添加完善的空指针检查和异常处理机制
- **位置**: `QueryWindowGenerator::generateQueryWindow()` 函数

### 2. 内存使用
- **100,000个对象** 预计占用约 **~2GB** 内存
- 如果内存不足，建议减少数据量或分批测试

### 3. 运行时间
- 完整测试时间 = 数据加载时间 + 索引构建时间 × 3 + 查询测试时间 × 3 × 4 × 100
- 预计：**30分钟 - 2小时**（取决于硬件配置）

## 📊 输出文件

如果使用后台运行，结果会保存在：
- `results.log` - 完整的运行日志
- 最终结果表格会在日志末尾

### 提取结果

只查看关键结果：
```bash
grep -A 50 "GLIN论文标准实验结果" results.log
```

只查看性能对比：
```bash
grep -E "(构建时间|查询时间|性能改进)" results.log
```

## 🎯 论文使用建议

### 实验设计
1. 使用真实的AREAWATER地理数据集（100,000个对象）
2. 测试4个不同的查询选择性级别（0.1%, 1%, 5%, 10%）
3. 每个选择性执行100次查询，取平均值
4. 对比3种方法的性能指标

### 关键指标
- **索引构建时间**: 衡量离线构建开销
- **平均查询时间**: 衡量在线查询性能
- **探测时间 vs 精炼时间**: 分析索引效率和误报率
- **候选数量**: 反映过滤效果

### 图表制作
可以使用结果数据制作以下图表：
1. **柱状图**: 索引构建时间对比
2. **折线图**: 不同选择性下的查询响应时间
3. **堆叠柱状图**: 探测时间与精炼时间的占比
4. **柱状图**: 候选数量对比（反映过滤效果）

## 💡 故障排除

### 段错误仍然发生
```bash
# 减少数据量
int max_lines = 10000;  # 先用1万条测试

# 减少查询窗口数量
int count = 10;  # 先用10个查询窗口
```

### 运行时间过长
```bash
# 只测试一个或两个选择性
std::vector<double> selectivities = {0.01};  // 只测试1%
```

### 内存不足
```bash
# 监控内存使用
watch -n 1 'ps aux | grep test_glin_paper_standard'

# 如果内存不足，减少数据量
int max_lines = 50000;  # 使用5万条数据
```

## ✅ 成功标志

测试成功完成时，你会看到：
1. ✅ 所有数据加载完成，没有错误
2. ✅ 3个方法的索引都构建成功
3. ✅ 所有查询测试完成，显示平均查询时间
4. ✅ 显示完整的对比表格
5. ✅ 显示性能改进总结

## 📞 支持

如果遇到问题：
1. 检查 `AREAWATER.csv` 文件路径是否正确
2. 确保有足够的内存和磁盘空间
3. 查看详细的错误日志定位问题

祝实验顺利！🎉
